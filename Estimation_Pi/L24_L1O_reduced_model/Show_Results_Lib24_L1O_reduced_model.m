%% Show_Results_Lib24_L1O_reduced_model
% SynTwin workflow script: visualization of Lib24 L1O reduced-model results.
%
% DESCRIPTION
%   Loads the compiled Results tensor generated by
%   Generate_Results_Lib24_L1O_reduced_model and produces representative plots:
%   - experimental vs predicted synthesis-rate trajectories (Pi)
%   - parameter estimates / distributions across L1O folds
%   - summary statistics and goodness-of-fit visualizations
%
% INPUTS
%   None (loads Results_Tensor_*.mat from the current folder).
%
% OUTPUTS
%   Figures shown on screen and/or saved to disk (depending on script settings).
%
% DEPENDENCIES
%   - SynTwin initialization recommended:
%       ROOT = init_SynTwin(...);
%   - Requires the corresponding Results_Tensor_*.mat to exist.
%
% USAGE
%   Show_Results_Lib24_L1O_reduced_model
%
% NOTES
%   - If you run from the SynTwin root, make sure this folder is on the path:
%       addpath(fileparts(mfilename('fullpath')));

% --- Portable project initialization (no absolute paths) ---
ROOT = init_SynTwin();  % Scripts_base + HEM_Surrogate are added by default
% Absolute path to the folder where this script lives (model folder)
SCRIPT_DIR = fileparts(mfilename('fullpath'));
addpath(SCRIPT_DIR);

% Consider an exogenous circuit. We use a Transcriptional Unit (TU) expressing GFP:
model_c.lp_c = 240; %Length of GFP protein (aa)     
model_c.le_c = model_c.lp_c^0.097/0.0703; 	%Ribosome occupancy length (aa) %lea=la^0.097/0.0703
model_c.dm_c  =  0.2; %Mean degradation rate of non-ribosomal mRNA (1/min)
model_c.Em_c =  model_c.lp_c/model_c.le_c*(1- (model_c.lp_c/(model_c.lp_c+model_c.le_c))^(model_c.lp_c/model_c.le_c)) ;  
model_c.WEm_c =  1 + 1/model_c.Em_c;  
model_c.N_pSC101 = 5; %known

% parameter bounds used in the estimations
Lower_Bounds = [0.025,0.05,0.05... %lower expected bounds for omega, promoter strengths,
                  0.05, 2.5e-3, 2.5e-3,2.5e-3 ...  %lower expected bounds for RBS_k0_sigma0, 
                  2.5 ];  %lower expected bound for high copy number multiplying term 
                
Upper_Bounds = [0.15,0.35,0.35... %upper expected bounds for omega, promoter strengths,
                  3.5, 20e-3,  20e-3,5e-2 ...  %upper expected bounds for RBS_k0_sigma0, 
                  8.25 ];  %upper expected bound for high copy number multiplying term 

% Lib24 bioparts indices:
indices_plasmids = [1,2];
indices_promoters = [1,2,3];
indices_rbss = [1,2,4,5];

%% WHAT DO YOU WANT TO SHOW: 
% Estimation based on the means of the well replicas for each experiment (INSTANCES)
instances = false;
% Estimation based on all the well replicas for each experiment (WELLS)
wells = true;

%% instances

if instances==true
    % Getting the Results structure corresponding to the estimated parameters of Lib24 with the reduced model using
    % Generate_Results_Lib24_L1O_reduced_model.m and stored in this same folder
    load(fullfile(SCRIPT_DIR,'Results_Tensor_Lib24_L1O_reduced_Instances.mat'));
    
    % Plots them 
    title_text = 'Lib24. L1O. RM. Instances. ';
    Plot_Results_Lib_approx_v2(Results_Tensor_Lib24_L1O_reduced,Lower_Bounds,Upper_Bounds,indices_plasmids,indices_promoters,indices_rbss, title_text)
end %

%% wells

if wells==true
    % Getting the Results structure corresponding to the estimated parameters of Lib24 with the reduced model using
    % Generate_Results_Lib24_L1O_reduced_model.m and stored in this same folder
    load(fullfile(SCRIPT_DIR,'Results_Tensor_Lib24_L1O_reduced_Wells.mat'));
    
    % Plots them 
     title_text = 'Lib24. L1O. RM. Wells. ';
     Plot_Results_Lib_approx_v2(Results_Tensor_Lib24_L1O_reduced,Lower_Bounds,Upper_Bounds,indices_plasmids,indices_promoters,indices_rbss,title_text)
end %wells

